---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section class="section" id="setup">
  <div class="container">
    <h4 class="section-title">{t('setup.title')}</h4>

    <!-- Install Command -->
    <div class="install-box">
      <div class="install-header">
        <span class="install-step">01</span>
        <span class="install-label">{t('setup.step1')}</span>
        <span class="install-hint">{t('setup.step1Hint')}</span>
      </div>
      <div class="install-command">
        <code>npx ralphy-spec init</code>
        <button class="copy-btn" data-copy="npx ralphy-spec init" title="Copy">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Tool Selection -->
    <div class="tool-section">
      <div class="tool-header">
        <span class="install-step">02</span>
        <span class="install-label">{t('setup.step2')}</span>
      </div>
      
      <div class="tool-tabs">
        <div class="tab-buttons">
          <button class="tab-btn active" data-tab="cursor">Cursor</button>
          <button class="tab-btn" data-tab="claude">Claude Code</button>
          <button class="tab-btn" data-tab="opencode">OpenCode</button>
        </div>

        <!-- Cursor Tab -->
        <div class="tab-content active" id="tab-cursor">
          <div class="tab-inner">
            <div class="commands-section">
              <div class="command-row">
                <code>/ralphy-plan</code>
                <span>→ {t('setup.cmd.plan')}</span>
              </div>
              <div class="command-row">
                <code>/ralphy-implement</code>
                <span>→ {t('setup.cmd.implement')}</span>
              </div>
              <div class="command-row">
                <code>/ralphy-validate</code>
                <span>→ {t('setup.cmd.validate')}</span>
              </div>
              <div class="command-row">
                <code>/ralphy-archive</code>
                <span>→ {t('setup.cmd.archive')}</span>
              </div>
            </div>
            <div class="structure-section">
              <div class="structure-label">{t('setup.filesCreated')}</div>
              <pre><code>.cursor/prompts/
├── ralphy-plan.md
├── ralphy-implement.md
├── ralphy-validate.md
└── ralphy-archive.md

openspec/
├── specs/
├── changes/
└── project.md</code></pre>
            </div>
          </div>
          <div class="example-section">
            <div class="example-label">{t('setup.example')}</div>
            <pre><code><span class="comment"># Plan</span>
/ralphy-plan Add user authentication with JWT

<span class="comment"># Implement</span>
/ralphy-implement add-user-auth

<span class="comment"># Validate</span>
/ralphy-validate

<span class="comment"># Archive</span>
/ralphy-archive add-user-auth</code></pre>
          </div>
        </div>

        <!-- Claude Code Tab -->
        <div class="tab-content" id="tab-claude">
          <div class="tab-inner">
            <div class="commands-section">
              <div class="command-row">
                <code>/ralphy-plan</code>
                <span>→ {t('setup.cmd.plan')}</span>
              </div>
              <div class="command-row">
                <code>/ralphy-implement</code>
                <span>→ {t('setup.cmd.implement')}</span>
              </div>
              <div class="command-row">
                <code>/ralphy-validate</code>
                <span>→ {t('setup.cmd.validate')}</span>
              </div>
              <div class="command-row">
                <code>/ralphy-archive</code>
                <span>→ {t('setup.cmd.archive')}</span>
              </div>
            </div>
            <div class="structure-section">
              <div class="structure-label">{t('setup.filesCreated')}</div>
              <pre><code>.claude/commands/
├── ralphy-plan.md
├── ralphy-implement.md
├── ralphy-validate.md
└── ralphy-archive.md

openspec/
├── specs/
├── changes/
└── project.md</code></pre>
            </div>
          </div>
          <div class="example-section">
            <div class="example-label">{t('setup.example')}</div>
            <pre><code><span class="comment"># Plan</span>
/ralphy-plan Add payment processing with Stripe

<span class="comment"># Implement</span>
/ralphy-implement add-payments

<span class="comment"># Validate & Archive</span>
/ralphy-validate && /ralphy-archive add-payments</code></pre>
          </div>
        </div>

        <!-- OpenCode Tab -->
        <div class="tab-content" id="tab-opencode">
          <div class="tab-inner">
            <div class="commands-section">
              <div class="command-row">
                <code>"Follow AGENTS.md to plan [feature]"</code>
              </div>
              <div class="command-row">
                <code>"Follow AGENTS.md to implement [change]"</code>
              </div>
              <div class="command-row">
                <code>"Follow AGENTS.md to validate"</code>
              </div>
              <div class="command-row">
                <code>"Follow AGENTS.md to archive [change]"</code>
              </div>
            </div>
            <div class="structure-section">
              <div class="structure-label">{t('setup.filesCreated')}</div>
              <pre><code>AGENTS.md

openspec/
├── specs/
├── changes/
└── project.md

.ralphy/
├── config.json
└── ralph-loop.state.json</code></pre>
            </div>
          </div>
          <div class="example-section">
            <div class="example-label">{t('setup.withRunner')}</div>
            <pre><code>npm install -g @th0rgal/ralph-wiggum

ralph "Follow AGENTS.md to implement add-api. \
  Output &lt;promise&gt;TASK_COMPLETE&lt;/promise&gt; when done." \
  --max-iterations 20</code></pre>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = (btn as HTMLElement).dataset.tab;
      
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(`tab-${tab}`)?.classList.add('active');
    });
  });

  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const text = btn.getAttribute('data-copy');
      if (text) {
        await navigator.clipboard.writeText(text);
        btn.classList.add('copied');
        setTimeout(() => btn.classList.remove('copied'), 2000);
      }
    });
  });
</script>

<style>
  .install-box {
    max-width: 420px;
    margin: 0 auto 2.5rem;
  }

  .install-header,
  .tool-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .install-step {
    font-size: 11px;
    color: var(--color-text-muted);
    opacity: 0.5;
  }

  .install-label {
    font-size: 12px;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .install-hint {
    font-size: 11px;
    color: var(--color-text-muted);
    margin-left: auto;
  }

  .install-command {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    padding: 0.875rem 1rem;
    border-radius: 6px;
  }

  .install-command code {
    background: none;
    border: none;
    color: var(--color-text);
    font-size: 14px;
    padding: 0;
  }

  .copy-btn {
    background: none;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.15s ease;
  }

  .copy-btn:hover {
    color: var(--color-text);
  }

  .copy-btn.copied {
    color: var(--color-success);
  }

  .tool-section {
    max-width: 720px;
    margin: 0 auto;
  }

  .tab-buttons {
    display: flex;
    gap: 0.25rem;
    margin-bottom: 1rem;
    background: var(--color-bg-secondary);
    padding: 0.25rem;
    border-radius: 6px;
    border: 1px solid var(--color-border);
  }

  .tab-btn {
    flex: 1;
    padding: 0.5rem 1rem;
    background: transparent;
    border: none;
    border-radius: 4px;
    color: var(--color-text-muted);
    font-size: 12px;
    font-family: var(--font-mono);
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .tab-btn:hover {
    color: var(--color-text-secondary);
  }

  .tab-btn.active {
    background: var(--color-bg-tertiary);
    color: var(--color-text);
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  .tab-inner {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .commands-section {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .command-row {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    padding: 0.625rem 0.75rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: 12px;
  }

  .command-row code {
    background: none;
    border: none;
    padding: 0;
    color: var(--color-text);
    font-size: 12px;
  }

  .command-row span {
    color: var(--color-text-muted);
    font-size: 11px;
  }

  .structure-section pre {
    margin: 0;
    font-size: 11px;
    line-height: 1.5;
  }

  .structure-label,
  .example-label {
    font-size: 10px;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
  }

  .example-section {
    border-top: 1px solid var(--color-border);
    padding-top: 1rem;
  }

  .example-section pre {
    margin: 0;
    font-size: 12px;
  }

  .example-section .comment {
    color: var(--color-text-muted);
  }

  @media (max-width: 640px) {
    .tab-inner {
      grid-template-columns: 1fr;
    }

    .tab-btn {
      padding: 0.5rem 0.5rem;
      font-size: 11px;
    }
  }
</style>
